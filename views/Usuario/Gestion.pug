extends ../layout

block content
  .container-fluid.d-flex.flex-column.min-h-100.p-4
    .shadow-lg.rounded.border.bg-light.p-4.d-flex.flex-column.flex-grow-1
      //- Contenedor para mostrar errores generales de la API
      #general-error.alert.alert-danger.d-none

      //- Título dinámico
      h3.text-center.my-4= title

      //- Fila principal que contiene los dos formularios como columnas
      .row.g-4
        //- Sección de Información Personal
        .col-lg-12
          form#formInformacionPersonal.p-4.border.rounded.h-100.d-flex.flex-column(autocomplete="off" novalidate)
            input(type="hidden" name="id" value=usuario.id)
            h5.mb-4 Información Personal
            .row.g-3.flex-grow-1
              .col-md-6
                label.form-label(for="dni") DNI
                input.form-control(type="text" id="dni" name="dni" required value=usuario.dni)
              .col-md-6
                label.form-label(for="nombre") Nombre(s)
                input.form-control(type="text" id="nombre" name="nombre" required value=usuario.nombre)
              .col-md-6
                label.form-label(for="apellido") Apellido(s)
                input.form-control(type="text" id="apellido" name="apellido" required value=usuario.apellido)
              .col-md-6
                label.form-label(for="fecha_nacimiento") Fecha de Nacimiento
                input.form-control(type="date" id="fecha_nacimiento" name="fecha_nacimiento" required value=usuario.fecha_nacimiento)
              .col-md-6
                label.form-label(for="sexo") Sexo
                select.form-select(id="sexo" name="sexo" required)
                  option(value="Masculino" selected=(usuario.sexo === 'Masculino')) Masculino
                  option(value="Femenino" selected=(usuario.sexo === 'Femenino')) Femenino
              .col-md-6
                label.form-label(for="telefono") Teléfono
                input.form-control(type="tel" id="telefono" name="telefono" required value=usuario.telefono)
              .col-12
                label.form-label(for="direccion") Dirección
                input.form-control(type="text" id="direccion" name="direccion" required value=usuario.direccion)
            .d-flex.justify-content-end.mt-4
              button.btn.btn-primary(type="submit")
                i.bi.bi-save-fill.me-2
                | Guardar

        //- Sección de Administración
        .col-lg-12
          .row.g-4
            //- Columna para Administración de Cuenta y Estado
            .col-lg-7.d-flex.flex-column
              //- Formulario de Administración
              form#formAdministracion.p-4.border.rounded.d-flex.flex-column.flex-grow-1(autocomplete="off" novalidate)
                  input(type="hidden" name="id" value=usuario.id)
                  h5.mb-4 Administrar cuenta
                  .row.g-3
                    .col-12
                      label.form-label(for="email") Correo Electrónico
                      input.form-control(type="email" id="email" name="email" required value=usuario.email)
                    .col-12
                      label.form-label(for="rol_id") Rol del Usuario
                      select.form-select(id="rol_id" name="rol_id" required)
                        if roles
                          each rol in roles
                            option(value=rol.id selected=(usuario.rol_id == rol.id)) #{rol.nombre}
                  //- Contenedor de botones
                  .d-flex.justify-content-end.align-items-center.mt-4
                    //- Botón de Alta/Baja
                    if usuario.activo
                      button.btn.btn-outline-danger.me-auto(type="button" 
                        data-bs-toggle="modal" 
                        data-bs-target="#confirmarEstadoModal"
                        data-usuario-id=usuario.id
                        data-nuevo-estado="false"
                        data-accion-texto="dar de baja"
                        data-btn-clase="btn-danger"
                        data-titulo="Confirmar Baja de Usuario")
                        i.bi.bi-person-x-fill.me-2
                        | Dar de Baja
                    else
                      button.btn.btn-outline-success.me-auto(type="button" 
                        data-bs-toggle="modal" 
                        data-bs-target="#confirmarEstadoModal"
                        data-usuario-id=usuario.id
                        data-nuevo-estado="true"
                        data-accion-texto="dar de alta"
                        data-btn-clase="btn-success"
                        data-titulo="Confirmar Alta de Usuario")
                        i.bi.bi-person-check-fill.me-2
                        | Dar de Alta
                    //- Botón de Guardar
                    button.btn.btn-primary(type="submit")
                      i.bi.bi-save-fill.me-2
                      | Guardar

            //- Columna para Cambio de Contraseña
            .col-lg-5
              form#formCambiarPassword.p-4.border.rounded.h-100.d-flex.flex-column(autocomplete="off" novalidate)
                input(type="hidden" name="id" value=usuario.id)
                h5.mb-4 Cambiar Contraseña
                .row.g-3.flex-grow-1
                  .col-12
                    label.form-label(for="password") Nueva Contraseña
                    input.form-control(type="password" id="password" name="password" required)
                  .col-12
                    label.form-label(for="passwordConfirmation") Confirmar Nueva Contraseña
                    input.form-control(type="password" id="passwordConfirmation" name="passwordConfirmation" required)
                .d-flex.justify-content-end.mt-4
                  button.btn.btn-warning(type="submit")
                    i.bi.bi-key-fill.me-2
                    | Cambiar Contraseña

      //- Botón para volver, fuera de los formularios
      .d-flex.justify-content-end.pt-3
        a.btn.btn-secondary.me-2(href="/usuarios/Listar")
          i.bi.bi-arrow-left.me-2
          | Volver

    //- Modal genérico para confirmar cambio de estado (Alta/Baja)
    #confirmarEstadoModal.modal.fade(tabindex="-1" aria-labelledby="confirmarEstadoModalLabel" aria-hidden="true")
      .modal-dialog
        .modal-content
          .modal-header
            h5#confirmarEstadoModalLabel.modal-title
            button.btn-close(type="button" data-bs-dismiss="modal" aria-label="Close")
          .modal-body
            p#confirmarEstadoModalBody
          .modal-footer
            button.btn.btn-secondary(type="button" data-bs-dismiss="modal") Cancelar
            //- Este botón no tiene un formulario, será manejado por JS
            button#confirmarEstadoBtn.btn(type="button")

block scripts
  script(src="/js/formEditPass.js")
  script(src="/js/formEditInfoPersonalUser.js")
  script(src="/js/formAdministrarCuenta.js")   
  script(src="/js/gestionEstadoUsuario.js")